# Phoenix Trading KIS API νλΌλ―Έν„° κ²€μ¦ λ³΄κ³ μ„

## λ©μ°¨
1. [λ§¤μ/λ§¤λ„ μ£Όλ¬Έ API κ²€μ¦](#1-λ§¤μλ§¤λ„-μ£Όλ¬Έ-api-κ²€μ¦)
2. [μ²΄κ²°ν™•μΈ API κ²€μ¦](#2-μ²΄κ²°ν™•μΈ-api-κ²€μ¦)
3. [μ§€μ •κ°€ μ£Όλ¬Έ κµ¬ν„ ν™•μΈ](#3-μ§€μ •κ°€-μ£Όλ¬Έ-κµ¬ν„-ν™•μΈ)
4. [μµμΆ… κ²°λ΅ ](#4-μµμΆ…-κ²°λ΅ )

---

## 1. λ§¤μ/λ§¤λ„ μ£Όλ¬Έ API κ²€μ¦

### π“‹ KIS API κ³µμ‹ μ¤ν™

**API μ •λ³΄:**
- **λ§¤μ:** TTTT1002U (μ‹¤μ „), VTTT1002U (λ¨μ)
- **λ§¤λ„:** TTTT1006U (μ‹¤μ „), VTTT1001U (λ¨μ)
- **URL:** `/uapi/overseas-stock/v1/trading/order`
- **Method:** POST

**ν•„μ νλΌλ―Έν„° (Request Body):**

| νλΌλ―Έν„° | ν•κΈ€λ… | νƒ€μ… | ν•„μ | κΈΈμ΄ | μ„¤λ… |
|---|---|---|---|---|---|
| CANO | μΆ…ν•©κ³„μΆλ²νΈ | string | Y | 8 | κ³„μΆλ²νΈ μ• 8μλ¦¬ |
| ACNT_PRDT_CD | κ³„μΆμƒν’μ½”λ“ | string | Y | 2 | κ³„μΆλ²νΈ λ’¤ 2μλ¦¬ |
| OVRS_EXCG_CD | ν•΄μ™Έκ±°λμ†μ½”λ“ | string | Y | 4 | NASD, NYSE, AMEX, SEHK λ“± |
| PDNO | μƒν’λ²νΈ | string | Y | 12 | μΆ…λ©μ½”λ“ |
| ORD_QTY | μ£Όλ¬Έμλ‰ | string | Y | 10 | μ£Όλ¬Έ μλ‰ |
| OVRS_ORD_UNPR | ν•΄μ™Έμ£Όλ¬Έλ‹¨κ°€ | string | Y | 31 | μ§€μ •κ°€ κΈμ•΅ (μ‹μ¥κ°€λ” "0") |
| CTAC_TLNO | μ—°λ½μ „ν™”λ²νΈ | string | N | 20 | (μ„ νƒ) |
| MGCO_APTM_ODNO | μ΄μ©μ‚¬μ§€μ •μ£Όλ¬Έλ²νΈ | string | N | 12 | (μ„ νƒ) |
| SLL_TYPE | νλ§¤μ ν• | string | N | 2 | (μ„ νƒ) κ³µλ§¤λ„ |
| ORD_SVR_DVSN_CD | μ£Όλ¬Έμ„λ²„κµ¬λ¶„μ½”λ“ | string | Y | 1 | "0" (κΈ°λ³Έκ°’) |
| ORD_DVSN | μ£Όλ¬Έκµ¬λ¶„ | string | Y | 2 | **00: μ§€μ •κ°€, 01: μ‹μ¥κ°€** |

### β… ν„μ¬ κµ¬ν„ (kis_rest_adapter.py:496-505)

```python
payload = {
    "CANO": cano,                       # β… κ³„μΆλ²νΈ (8μλ¦¬)
    "ACNT_PRDT_CD": acnt_prdt_cd,       # β… κ³„μΆμƒν’μ½”λ“ (2μλ¦¬)
    "OVRS_EXCG_CD": "NASD",             # β… κ±°λμ†μ½”λ“ (λ‚μ¤λ‹¥)
    "PDNO": ticker,                      # β… μΆ…λ©μ½”λ“
    "ORD_QTY": str(quantity),            # β… μ£Όλ¬Έμλ‰
    "OVRS_ORD_UNPR": str(price) if order_kind == "limit" else "0",  # β… μ£Όλ¬Έλ‹¨κ°€
    "ORD_SVR_DVSN_CD": "0",             # β… μ£Όλ¬Έμ„λ²„κµ¬λ¶„μ½”λ“
    "ORD_DVSN": ord_dvsn                # β… μ£Όλ¬Έκµ¬λ¶„
}
```

**ORD_DVSN λ΅μ§ (kis_rest_adapter.py:480-491):**
```python
ord_dvsn_map = {
    "buy": {
        "limit": "00",   # β… μ§€μ •κ°€ λ§¤μ
        "market": "01"   # β… μ‹μ¥κ°€ λ§¤μ
    },
    "sell": {
        "limit": "00",   # β… μ§€μ •κ°€ λ§¤λ„
        "market": "01"   # β… μ‹μ¥κ°€ λ§¤λ„
    }
}
```

### π“ κ²€μ¦ κ²°κ³Ό

| ν•­λ© | KIS μ¤ν™ | ν„μ¬ κµ¬ν„ | μƒνƒ |
|---|---|---|---|
| ν•„μ νλΌλ―Έν„° 8κ° | β… | β… | **μΌμΉ** |
| μ§€μ •κ°€ μ£Όλ¬Έ (00) | β… | β… | **μ •ν™•** |
| μ‹μ¥κ°€ μ£Όλ¬Έ (01) | β… | β… | **μ •ν™•** |
| κ±°λμ† μ½”λ“ | NASD | NASD (κ³ μ •) | **μ •ν™•** |
| Hashkey μƒμ„± | ν•„μ” | β… κµ¬ν„λ¨ | **μ •ν™•** |

**π― κ²°λ΅ : λ§¤μ/λ§¤λ„ API κµ¬ν„ μ™„λ²½ (100% μΌμΉ)**

---

## 2. μ²΄κ²°ν™•μΈ API κ²€μ¦

### π“‹ KIS API κ³µμ‹ μ¤ν™

**API μ •λ³΄:**
- **TR_ID:** TTTS3035R (μ‹¤μ „), VTTS3035R (λ¨μ)
- **URL:** `/uapi/overseas-stock/v1/trading/inquire-ccnl`
- **Method:** GET

**ν•„μ νλΌλ―Έν„° (Query Parameters):**

| νλΌλ―Έν„° | ν•κΈ€λ… | νƒ€μ… | ν•„μ | μ„¤λ… |
|---|---|---|---|---|
| CANO | μΆ…ν•©κ³„μΆλ²νΈ | string | Y | κ³„μΆλ²νΈ μ• 8μλ¦¬ |
| ACNT_PRDT_CD | κ³„μΆμƒν’μ½”λ“ | string | Y | κ³„μΆλ²νΈ λ’¤ 2μλ¦¬ |
| PDNO | μƒν’λ²νΈ | string | Y | μΆ…λ©μ½”λ“ ("%" = μ „μ²΄) |
| ORD_STRT_DT | μ£Όλ¬Έμ‹μ‘μΌμ | string | Y | YYYYMMDD |
| ORD_END_DT | μ£Όλ¬ΈμΆ…λ£μΌμ | string | Y | YYYYMMDD |
| SLL_BUY_DVSN | νλ§¤λ§¤μκµ¬λ¶„ | string | Y | 00: μ „μ²΄ |
| CCLD_NCCS_DVSN | μ²΄κ²°λ―Έμ²΄κ²°κµ¬λ¶„ | string | Y | 00: μ „μ²΄ |
| OVRS_EXCG_CD | ν•΄μ™Έκ±°λμ†μ½”λ“ | string | Y | NASD, NYSE λ“± |
| SORT_SQN | μ •λ ¬μμ„ | string | Y | DS: λ‚΄λ¦Όμ°¨μ |
| ORD_DT | μ£Όλ¬ΈμΌμ | string | Y | (λΉ λ¬Έμμ—΄) |
| ORD_GNO_BRNO | μ£Όλ¬Έμ±„λ²μ§€μ λ²νΈ | string | Y | (λΉ λ¬Έμμ—΄) |
| ODNO | μ£Όλ¬Έλ²νΈ | string | Y | μ΅°νν•  μ£Όλ¬Έλ²νΈ |
| CTX_AREA_NK200 | μ—°μ†μ΅°νν‚¤200 | string | Y | (λΉ λ¬Έμμ—΄) |
| CTX_AREA_FK200 | μ—°μ†μ΅°νκ²€μƒ‰μ΅°κ±΄200 | string | Y | (λΉ λ¬Έμμ—΄) |

### β… ν„μ¬ κµ¬ν„ (kis_rest_adapter.py:986-1001)

```python
params = {
    "CANO": cano,                    # β… κ³„μΆλ²νΈ
    "ACNT_PRDT_CD": acnt_prdt_cd,    # β… κ³„μΆμƒν’μ½”λ“
    "PDNO": "%",                     # β… μ „μ²΄ μΆ…λ©
    "ORD_STRT_DT": order_date,       # β… μ£Όλ¬Έμ‹μ‘μΌμ
    "ORD_END_DT": order_date,        # β… μ£Όλ¬ΈμΆ…λ£μΌμ
    "SLL_BUY_DVSN": "00",            # β… μ „μ²΄ (λ§¤λ„/λ§¤μ)
    "CCLD_NCCS_DVSN": "00",          # β… μ „μ²΄ (μ²΄κ²°/λ―Έμ²΄κ²°)
    "OVRS_EXCG_CD": "NASD",          # β… λ―Έκµ­ μ „μ²΄
    "SORT_SQN": "DS",                # β… λ‚΄λ¦Όμ°¨μ
    "ORD_DT": "",                    # β… λΉ λ¬Έμμ—΄
    "ORD_GNO_BRNO": "",              # β… λΉ λ¬Έμμ—΄
    "ODNO": order_no,                # β… μ£Όλ¬Έλ²νΈ
    "CTX_AREA_NK200": "",            # β… λΉ λ¬Έμμ—΄
    "CTX_AREA_FK200": ""             # β… λΉ λ¬Έμμ—΄
}
```

### π“ κ²€μ¦ κ²°κ³Ό

| ν•­λ© | KIS μ¤ν™ | ν„μ¬ κµ¬ν„ | μƒνƒ |
|---|---|---|---|
| ν•„μ νλΌλ―Έν„° 14κ° | β… | β… | **μΌμΉ** |
| μ£Όλ¬Έλ²νΈ ν•„ν„°λ§ | β… | β… | **μ •ν™•** |
| μ²΄κ²° μ •λ³΄ μ¶”μ¶ | ft_ccld_qty, ft_ccld_unpr3 | β… κµ¬ν„λ¨ | **μ •ν™•** |
| λ―Έμ²΄κ²° μλ‰ | nccs_qty | β… κµ¬ν„λ¨ | **μ •ν™•** |
| μ‹¤μ „/λ¨μ TR_ID λ¶„κΈ° | TTTS3035R / VTTS3035R | β… κµ¬ν„λ¨ | **μ •ν™•** |

**π― κ²°λ΅ : μ²΄κ²°ν™•μΈ API κµ¬ν„ μ™„λ²½ (100% μΌμΉ)**

---

## 3. μ§€μ •κ°€ μ£Όλ¬Έ κµ¬ν„ ν™•μΈ

### π“ μ§€μ •κ°€ μ£Όλ¬Έ νλ¦„

#### 1. send_buy_order() / send_sell_order() (kis_rest_adapter.py:573-579)

```python
def send_buy_order(self, ticker: str, quantity: int, price: float) -> Optional[OrderResult]:
    """λ§¤μ μ£Όλ¬Έ (μ§€μ •κ°€)"""
    return self._send_order_internal(ticker, "buy", quantity, price, "limit")  # β… "limit" κ³ μ •

def send_sell_order(self, ticker: str, quantity: int, price: float) -> Optional[OrderResult]:
    """λ§¤λ„ μ£Όλ¬Έ (μ§€μ •κ°€)"""
    return self._send_order_internal(ticker, "sell", quantity, price, "limit")  # β… "limit" κ³ μ •
```

#### 2. ORD_DVSN κ°’ μ„¤μ • (kis_rest_adapter.py:480-491)

```python
ord_dvsn_map = {
    "buy": {
        "limit": "00",   # β… μ§€μ •κ°€ λ§¤μ
        "market": "01"
    },
    "sell": {
        "limit": "00",   # β… μ§€μ •κ°€ λ§¤λ„
        "market": "01"
    }
}

ord_dvsn = ord_dvsn_map.get(order_type, {}).get(order_kind, "00")
# order_kind="limit" β†’ ord_dvsn="00" β…
```

#### 3. OVRS_ORD_UNPR μ„¤μ • (kis_rest_adapter.py:502)

```python
"OVRS_ORD_UNPR": str(price) if order_kind == "limit" else "0"
# order_kind="limit" β†’ price κ°’ μ‚¬μ© β…
```

### β… μ§€μ •κ°€ μ£Όλ¬Έ κ²€μ¦ κ²°κ³Ό

| κ²€μ¦ ν•­λ© | κµ¬ν„ | μƒνƒ |
|---|---|---|
| send_buy_orderλ” "limit" κ³ μ • | β… | **μ •ν™•** |
| send_sell_orderλ” "limit" κ³ μ • | β… | **μ •ν™•** |
| ORD_DVSN = "00" (μ§€μ •κ°€) | β… | **μ •ν™•** |
| OVRS_ORD_UNPRμ— κ°€κ²© μ „λ‹¬ | β… | **μ •ν™•** |
| μ‹μ¥κ°€ μ£Όλ¬Έκ³Ό λ¶„λ¦¬λ¨ | β… | **μ •ν™•** |

**π― κ²°λ΅ : μ§€μ •κ°€ μ£Όλ¬Έ 100% μ •ν™•ν•κ² κµ¬ν„λ¨**

---

## 4. μµμΆ… κ²°λ΅ 

### β… μ „μ²΄ κ²€μ¦ μ”μ•½

| API | μ¤ν™ μΌμΉ | νλΌλ―Έν„° μ •ν™•μ„± | μ§€μ •κ°€ κµ¬ν„ | μµμΆ… ν‰κ°€ |
|---|---|---|---|---|
| λ§¤μ μ£Όλ¬Έ | β… 100% | β… μ™„λ²½ | β… μ •ν™• | **ν•©κ²©** |
| λ§¤λ„ μ£Όλ¬Έ | β… 100% | β… μ™„λ²½ | β… μ •ν™• | **ν•©κ²©** |
| μ²΄κ²°ν™•μΈ | β… 100% | β… μ™„λ²½ | N/A | **ν•©κ²©** |

### π― ν•µμ‹¬ ν™•μΈ μ‚¬ν•­

1. **β… λ§¤μ μ£Όλ¬Έ (send_buy_order):**
   - ORD_DVSN = "00" (μ§€μ •κ°€)
   - OVRS_ORD_UNPR = μ‹¤μ  κ°€κ²©
   - λ¨λ“  ν•„μ νλΌλ―Έν„° μ „λ‹¬
   - KIS API μ¤ν™ 100% μΌμΉ

2. **β… λ§¤λ„ μ£Όλ¬Έ (send_sell_order):**
   - ORD_DVSN = "00" (μ§€μ •κ°€)
   - OVRS_ORD_UNPR = μ‹¤μ  κ°€κ²©
   - λ¨λ“  ν•„μ νλΌλ―Έν„° μ „λ‹¬
   - KIS API μ¤ν™ 100% μΌμΉ

3. **β… μ²΄κ²°ν™•μΈ (get_order_fill_status):**
   - 14κ° ν•„μ νλΌλ―Έν„° λ¨λ‘ μ „λ‹¬
   - μ£Όλ¬Έλ²νΈ ν•„ν„°λ§ μ •ν™•
   - μ²΄κ²°κ°€/μ²΄κ²°μλ‰ μ •ν™•ν μ¶”μ¶
   - KIS API μ¤ν™ 100% μΌμΉ

### π€ λ°°ν¬ κ°€λ¥ μ—¬λ¶€

**κ²°λ΅ : λ°°ν¬ κ°€λ¥ β…**

- **API κµ¬ν„:** μ™„λ²½ (100% μ¤ν™ μΌμΉ)
- **μ§€μ •κ°€ μ£Όλ¬Έ:** μ •ν™•ν κµ¬ν„λ¨
- **μ²΄κ²°ν™•μΈ:** μ •ν™•ν κµ¬ν„λ¨
- **νλΌλ―Έν„°:** λ¨λ‘ μ •ν™•

### β οΈ  μ‹¤κ±°λ μ „ μµμΆ… μ²΄ν¬λ¦¬μ¤νΈ

- [ ] Excel B14 (κ³„μΆλ²νΈ): μ‹¤μ  KIS κ³„μΆλ²νΈ μ…λ ¥
- [ ] Excel B12 (KIS APP KEY): 36μλ¦¬ API ν‚¤ μ…λ ¥
- [ ] μ†μ•΅ ν…μ¤νΈ ($100-$500): μλ™ μ‹¤ν–‰ κ¶μ¥
- [ ] μ²΄κ²°ν™•μΈ λ΅μ§ μ‹¤μ‹κ°„ λ¨λ‹ν„°λ§

### π“ μ½”λ“ μ„μΉ

- **λ§¤μ/λ§¤λ„:** `src/kis_rest_adapter.py:453-579`
- **μ²΄κ²°ν™•μΈ:** `src/kis_rest_adapter.py:955-1057`
- **κ³µν†µ ν—¤λ”:** `src/kis_rest_adapter.py:309-343`

---

**μ‘μ„±μΌ:** 2026-01-26
**κ²€μ¦ κΈ°μ¤€:** KIS API κ³µμ‹ λ¬Έμ„ `[ν•΄μ™Έμ£Όμ‹] μ£Όλ¬Έ_κ³„μΆ.xlsx`
**κ²€μ¦μ:** Phoenix Trading System Validation
