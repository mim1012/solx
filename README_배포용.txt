================================================================
Phoenix Trading System v4.1 (ENHANCED)
SOXL 자동매매 시스템 with 미국 시장 설정 & 잔고 동기화
================================================================

📋 설치 방법:

1. 환경 설정 파일 생성 (.env)
   - .env.example 파일을 .env로 복사
   - 텍스트 편집기로 .env 파일 열기
   - 다음 항목을 실제 값으로 수정:

     # 한국투자증권(KIS) REST API 자격증명 (필수)
     KIS_APP_KEY=your_app_key_here
     KIS_APP_SECRET=your_app_secret_here
     KIS_ACCOUNT_NO=your_account_number_here
     KIS_API_MODE=REAL  # REAL: 실전거래, PAPER: 모의투자

     # 미국 시장 설정 (선택, 기본값: SOXL/AMS/USD)
     US_MARKET_TICKER=SOXL
     US_MARKET_EXCHANGE=AMS  # SOXL: AMS, 일반 종목: NAS, NYS
     US_MARKET_CURRENCY=USD

     # 텔레그램 알림 (선택)
     TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
     TELEGRAM_CHAT_ID=123456789

     # 시스템 설정 (선택)
     LOG_LEVEL=INFO
     DEBUG_MODE=false
     BALANCE_SYNC_INTERVAL=60  # 잔고 동기화 간격 (초)

   - 저장 (Ctrl + S)

2. Excel 템플릿 설정
   - phoenix_grid_template_v3.xlsx 파일 열기
   - 시트 1 "01_매매전략_기준설정" 에서 다음 항목 입력:

     [기본 설정]
     - 계좌번호: 한국투자증권 계좌번호 (예: 12345678-01)
     - 종목코드: SOXL (변경 금지)
     - 투자금 (USD): 총 투자 금액 (예: 10000)
     - 1티어 금액 (USD): 티어당 투자 금액 (예: 500)

     [선택 설정]
     - 1티어 거래 여부: FALSE (기본) 또는 TRUE (Tier 1 매수/매도 활성화)
     - 텔레그램 ID: 텔레그램 채팅 ID (알림 받으려면 필수)
     - 텔레그램 Token: 텔레그램 봇 토큰
     - 알림 활성화: TRUE (텔레그램 알림 사용)

   - 저장 (Ctrl + S)

3. 실행
   - PhoenixTrading.exe 더블클릭
   - 콘솔 창이 열리면서 시스템 시작
   - 키움증권 로그인 창이 나타남 (로그인)
   - 시스템이 자동으로 거래 시작

4. 종료
   - 콘솔 창에서 Ctrl + C 누르기
   - 안전하게 종료됨 (Excel 파일 자동 저장)

================================================================

⚠️ 중요 주의사항:

1. 실거래 시스템입니다
   - 실제 자금이 사용됩니다
   - 손실 가능성이 있습니다
   - 충분히 이해하고 사용하세요

2. SOXL은 고위험 상품입니다
   - 3배 레버리지 ETF
   - 변동성이 매우 큽니다
   - 소액으로 시작하세요 (권장: $1,000~$5,000)

3. 텔레그램 알림 설정을 권장합니다
   - 매매 체결 시 실시간 알림
   - 시스템 상태 모니터링
   - 에러 발생 시 즉시 알림

4. 키움 OpenAPI는 필수입니다
   - 설치하지 않으면 실행 안 됨
   - 반드시 먼저 설치하세요

5. Excel 파일은 PhoenixTrading.exe와 같은 폴더에 있어야 합니다

================================================================

📁 파일 구조:

PhoenixTrading.exe              ← 실행 파일
phoenix_grid_template_v3.xlsx   ← 설정 파일 (필수!)
_internal\                      ← 내부 라이브러리 (삭제 금지!)
logs\                           ← 로그 폴더 (자동 생성)

================================================================

🔧 문제 해결:

문제 1: "Excel 템플릿을 찾을 수 없습니다"
해결: phoenix_grid_template_v3.xlsx 파일을 PhoenixTrading.exe와 같은 폴더에 배치

문제 2: "KIS API 로그인 실패"
해결: 
  1. .env 파일에 KIS_APP_KEY, KIS_APP_SECRET, KIS_ACCOUNT_NO 확인
  2. KIS 개발자센터(https://apiportal.koreainvestment.com/)에서 앱키 권한 확인
  3. 계좌번호 형식 확인 (예: 12345678-01)

문제 3: "잔고 부족으로 배치 매수 중단: 필요=$539.12, 잔고=$0.00"
해결: 
  1. test_kis_fix.py 실행하여 예수금 조회 테스트
  2. .env 파일에서 US_MARKET_EXCHANGE=AMS 확인
  3. 증권사 앱에서 USD 잔고 확인 및 입금

문제 4: "VCRUNTIME140.dll이 없습니다"
해결: Visual C++ 재배포 패키지 설치
      https://aka.ms/vs/17/release/vc_redist.x86.exe

문제 5: 로그인 후 아무 반응이 없음
해결: 
  1. logs 폴더의 최신 로그 파일 확인
  2. test_config.py 실행하여 설정 검증
  3. test_kis_fix.py 실행하여 API 연결 테스트

================================================================

📞 긴급 상황 대응:

1. 시스템 즉시 종료
   방법: Ctrl + C 누르기

2. 매수 일시 중단
   방법: Excel 파일 → "매수 제한" = TRUE 설정 → 저장

3. 매도 일시 중단
   방법: Excel 파일 → "매도 제한" = TRUE 설정 → 저장

4. 전체 청산 (수동)
   방법: 키움 HTS(영웅문) 접속 → 수동으로 전량 매도

================================================================

💡 팁:

1. 시작 전 체크리스트
   ☑ 키움 OpenAPI+ 설치 완료
   ☑ Excel 템플릿 설정 완료
   ☑ 텔레그램 알림 설정 (권장)
   ☑ 소액으로 테스트

2. 실행 중 모니터링
   ☑ 콘솔 창 로그 확인
   ☑ Excel 파일 주기적 확인 (실시간 업데이트)
   ☑ 텔레그램 알림 확인
   ☑ 키움 HTS로 계좌 확인

3. 종료 후
   ☑ Excel 파일 백업
   ☑ logs 폴더 확인
   ☑ 거래 내역 검토

================================================================

📚 추가 정보:

- Tier 1 거래 기능 (CUSTOM v4.1)
  "1티어 거래 여부"를 TRUE로 설정하면 Tier 1에서도 매수/매도 가능

- 240단계 그리드 시스템
  0.5% 간격으로 240개 티어 자동 매매

- 3% 자동 익절
  각 티어별 3% 수익 달성 시 자동 매도

- High Water Mark (Tier 1)
  보유 주식이 없을 때 최고가 자동 추적

- 미국 시장 설정 지원
  환경 변수로 종목, 거래소, 통화 설정 가능

- 자동 잔고 동기화
  주기적으로 KIS API에서 잔고 조회 및 상태 동기화

- 예수금 조회 문제 해결
  SOXL 거래소(AMS) 자동 감지 및 설정

================================================================

버전: v4.1 (ENHANCED)
릴리즈: 2026-02-04
주요 개선사항:
✅ 미국 시장 설정 지원 (환경 변수 기반)
✅ 예수금 조회 문제 해결 (SOXL → AMS 거래소 자동 감지)
✅ 자동 잔고 동기화 기능 추가
✅ KIS REST API 호환성 개선
✅ 상세 디버그 로그 강화

⚠️ 투자 책임은 사용자에게 있습니다.
⚠️ 손실 가능성을 충분히 인지하고 사용하세요.
⚠️ 소액으로 충분히 테스트한 후 실거래를 시작하세요.

================================================================
